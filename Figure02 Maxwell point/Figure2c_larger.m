clear all
close all
clc

ds = 1.5; di = 1; 

% defien N-shaped function
a = -6.0; b = 9.7; c = 0.1;

% f = @(u,v) u.^3 + a*u.^2 + b*u + c - v;

p_star = 6.3;  % <
% p_star = 6.49944807184556;  % =
p_star = 6.6;  % >

% P_u = 6.77541214906364;
% P_d = 6.22458785093636;
% p_star = (P_u + P_d)/2;

syms q
fun_g = @(q) ((p_star+q)/2/ds).^3 + a*((p_star+q)/2/ds).^2 + b*((p_star+q)/2/ds) + c - (p_star-q)/2/di;
solutions = solve(fun_g, q);
q_points = double(solutions)';
q_points = sort(q_points);

Hamilton = @(q) 1/4*((p_star+q)/2/ds).^4*2*ds + a/3*((p_star+q)/2/ds).^3*2*ds + b/2*((p_star+q)/2/ds).^2*2*ds + c*q ...
                       + 1/2*((p_star-q)/2/di).^2*2*di;


h_points = Hamilton(q_points);
abs(h_points(1) - h_points(3))

q_values = linspace(min(q_points)-2,max(q_points)+2,500);
g_values = fun_g(q_values);
h_values = Hamilton(q_values);


figure
hold on




x1 = linspace(q_points(1), q_points(2), 100);
x1_fill = [x1, fliplr(x1)]; 
y1 = fun_g(x1);
y1_fill = [y1,zeros(size(y1))];  

fill(x1_fill, y1_fill, 'c', 'FaceAlpha', 0.3,'EdgeColor', 'none'); 

x2 = linspace(q_points(2), q_points(3), 100);
x2_fill = [x2, fliplr(x2)];  
y2 = fun_g(x2);
y2_fill = [y2,zeros(size(y2))]; 
fill(x2_fill, y2_fill, 'r', 'FaceAlpha', 0.3,'EdgeColor', 'none');  

plot(q_values,g_values,'k-','LineWidth',2.0);
plot(q_values,zeros(size(g_values)),'k-','LineWidth',2.0);
% yline(0,'k-','LineWidth',2.0);

plot(q_points(1),0,'MarkerSize',12,'Marker','o',...
    'LineWidth',2,...
    'LineStyle','none',...
    'Color','k','MarkerFaceColor', 'k')

plot(q_points(2),0,'MarkerSize',12,'Marker','o',...
    'LineWidth',2,...
    'LineStyle','none',...
    'Color','k','MarkerFaceColor', 'w')

plot(q_points(3),0,'MarkerSize',12,'Marker','o',...
    'LineWidth',2,...
    'LineStyle','none',...
    'Color','k','MarkerFaceColor', 'k')

xlim([-4.35649336799281 3.23904061300135]);
ylim([-0.5 0.5]);

set(gca, 'XTick', [], 'XTickLabel', []);
set(gca, 'YTick', [], 'YTickLabel', []);

set(gca, 'XAxisLocation', 'origin');
title('$P^{*}>P^{*}_{\rm{Maxwell}}$','FontSize',24,'Interpreter','latex');

set(gca,'linewidth',2,'FontSize',30)

%%

annotation('arrow',[0.889285714285714 0.965178571428571],...
    [0.478571428571429 0.478571428571429],'LineWidth',2,'HeadWidth',15,...
    'HeadLength',15);
annotation('arrow',[0.1309 0.1309],...
    [0.795238095238095 0.933333333333334],'LineWidth',2,'HeadWidth',15,...
    'HeadLength',15);

annotation('textbox',...
    [0.0544642857142854 0.601584255946241 0 0.0234157440537617],...
    'String',{'$g(P^{*},Q)$'},...
    'Rotation',90,...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation('textbox',...
    [0.0727261904761891 0.464285714285714 0.0504880952380966 0.0941244137058818],...
    'String',{'$0$'},...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation('textbox',...
    [0.888251984126983 0.351190476190476 0.065319444444446 0.116710844009485],...
    'String',{'$Q$'},...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');


annotation('textbox',...
    [0.248780257936502 0.370238095238098 0.0940768849206403 0.0990851415757897],...
    'String','$Q_{-}$',...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation('textbox',...
    [0.399301091269832 0.371428571428573 0.0873060515873093 0.101767711724769],...
    'String','$Q_{0}$',...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation('textbox',...
    [0.794067956349196 0.372619047619048 0.0827177579365167 0.105436507197039],...
    'String','$Q_{+}$',...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');

figure_name = ['./Figure2c.eps'];
saveas(gcf, figure_name, 'epsc');

