clear all;
close all;
clc;

x_vals = linspace(0, 100.5, 1000);

% defien N-shaped function
a = -6.0; b = 9.7; c = 0.1;

f = @(x) x.^3 + a*x.^2 + b*x + c;


syms x_sym
f_sym = x_sym^3 + a*x_sym^2 + b*x_sym + c;
f_prime = diff(f_sym, x_sym);
f_prime_num = matlabFunction(f_prime);

eqn = f_prime == -1;
solutions = solve(eqn, x_sym);
x_points = double(solutions)



%%
l1 = @(x) -x + 3.8;
l1_sym = -x_sym + 3.8;
f_l1_sym = f_sym - l1_sym;
f_l1_solutions = solve(f_l1_sym, x_sym);
x_f_l1_points = double(f_l1_solutions);
x_f_l1_points = x_f_l1_points(1);
y_f_l1_points = l1(x_f_l1_points);
y_l1 = l1(x_vals);

[x_f_l1_points, y_f_l1_points]

%%
l2 = @(x) -x + 5.7;
l2_sym = -x_sym + 5.7;
f_l2_sym = f_sym - l2_sym;
f_l2_solutions = solve(f_l2_sym, x_sym);
x_f_l2_points = double(f_l2_solutions);
y_f_l2_points = l2(x_f_l2_points);
y_l2 = l2(x_vals);

[x_f_l2_points, y_f_l2_points]

%%
l3 = @(x) -x + 7.1;
l3_sym = -x_sym + 7.1;
f_l3_sym = f_sym - l3_sym;
f_l3_solutions = solve(f_l3_sym, x_sym);
x_f_l3_points = double(f_l3_solutions);
x_f_l3_points = x_f_l3_points(3);
y_f_l3_points = l3(x_f_l3_points);
y_l3 = l3(x_vals);

[x_f_l3_points, y_f_l3_points]

%%
y_points = f(x_points);

N1 = l1(0);
N2 = l2(0);
N3 = l3(0);
Np = x_points(1) + y_points(1);
Nm = x_points(2) + y_points(2);

save data_Nvalues N1 N2 N3 Nm Np x_f_l1_points y_f_l1_points  x_f_l2_points y_f_l2_points  x_f_l3_points y_f_l3_points

figure('Position', [100, 100, 600, 600]);

set(gcf, 'Color', 'w');
hold on;

% x = linspace(-4, 10, 500);
% y = f(x);
% plot(x, y, 'k-', 'LineWidth', 3);  

x1 = linspace(0,x_points(1),100); y1 = f(x1);
x2 = linspace(x_points(1),x_points(2),100); y2 = f(x2);
x3 = linspace(x_points(2),6.5,100); y3 = f(x3);

% plot(x_vals, y_l1, 'LineWidth', 2, 'Color',[0.494117647409439 0.494117647409439 0.494117647409439]);
% plot(x_vals, y_l2, 'LineWidth', 2, 'Color',[0.494117647409439 0.494117647409439 0.494117647409439]);
% plot(x_vals, y_l3, 'LineWidth', 2, 'Color',[0.494117647409439 0.494117647409439 0.494117647409439]);

% plot(x_vals, y_l1, 'LineWidth', 2, 'Color','b');
% plot(x_vals, y_l2, 'LineWidth', 2, 'Color','b');
% plot(x_vals, y_l3, 'LineWidth', 2, 'Color','b');

tangent = @(x) -1*(x) + x_points(1) + y_points(1);
tangent_y1 = tangent(x_vals);

tangent = @(x) -1*(x) + x_points(2) + y_points(2);
tangent_y2 = tangent(x_vals);

area = fill([x_vals fliplr(x_vals)],[tangent_y1 fliplr(tangent_y2)],[0.933333337306976 0.933333337306976 0.933333337306976],'edgealpha', '0', 'facealpha', '.5');

plot(x_vals, tangent_y1,  'Color',[0.800000011920929 0.800000011920929 0.800000011920929], 'LineWidth', 3);
plot(x_vals, tangent_y2,  'Color',[0.800000011920929 0.800000011920929 0.800000011920929], 'LineWidth', 3);

plot(x1, y1, 'k-', 'LineWidth', 3);  
plot(x2, y2, 'k--', 'LineWidth', 3);  
plot(x3, y3, 'k-', 'LineWidth', 3);  

% plot(x_points, y_points,'MarkerSize',18,'Marker','.','LineStyle','none','Color','r');
plot(x_vals, y_l1, 'LineWidth', 2, 'Color','b');
plot(x_vals, y_l2, 'LineWidth', 2, 'Color','b');
plot(x_vals, y_l3, 'LineWidth', 2, 'Color','b');

plot([x_f_l2_points(1),x_f_l2_points(1)], [0,y_f_l2_points(1)],'LineWidth',1.5,'LineStyle',':','Color','k');
plot([x_f_l2_points(2),x_f_l2_points(2)], [0,y_f_l2_points(2)],'LineWidth',1.5,'LineStyle',':','Color','k');
plot([x_f_l2_points(3),x_f_l2_points(3)], [0,y_f_l2_points(3)],'LineWidth',1.5,'LineStyle',':','Color','k');

plot(x_points, y_points, 'ro', 'MarkerSize', 8, 'MarkerFaceColor', 'r'); 

plot(x_f_l1_points(1), y_f_l1_points(1), 'ko', 'MarkerSize', 8, 'MarkerFaceColor', 'k'); 
plot(x_f_l3_points(1), y_f_l3_points(1), 'ko', 'MarkerSize', 8, 'MarkerFaceColor', 'k'); 

plot(x_f_l2_points(1), y_f_l2_points(1), 'ko', 'MarkerSize', 8, 'MarkerFaceColor', 'k'); 
plot(x_f_l2_points(2), y_f_l2_points(2), 'ko', 'MarkerSize', 8, 'LineWidth', 2, 'MarkerFaceColor', 'w'); 
plot(x_f_l2_points(3), y_f_l2_points(3), 'ko', 'MarkerSize', 8, 'MarkerFaceColor', 'k'); 


axis equal
xlim([0, 7.5]);
ylim([0, 7.5]);


set(gca, 'XTick', [], 'XTickLabel', []);
set(gca, 'YTick', [], 'YTickLabel', []);
set(gca, 'LineWidth', 2);


%%
annotation('textbox',...
    [0.0335576923076947 0.910833333333335 0.0795192307692285 0.105833333333334],...
    'String',{'$u$'},...
    'Interpreter','latex',...
    'FontSize',48,...
    'FontName','Times New Roman',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation('textbox',...
    [0.902656250000003 0.0198333355585755 0.0378906249999993 0.128499997774759],...
    'String',{'$v$'},...
    'Interpreter','latex',...
    'FontSize',48,...
    'FontName','Times New Roman',...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation('arrow',[0.1303 0.1303],...
    [0.89 0.97],'LineWidth',2,'HeadWidth',15,...
    'HeadLength',15);
annotation(gcf,'arrow',[0.90 0.97],...
    [0.1295 0.1295],'LineWidth',2,'HeadWidth',15,...
    'HeadLength',15);

annotation(gcf,'textbox',...
    [0.567153846153843 0.639166666666672 0.302461538461542 0.0841701513884531],...
    'String','$f(u,v)=0$',...
    'Interpreter','latex',...
    'FontSize',30,...
    'FitBoxToText','off',...
    'EdgeColor','none');


annotation(gcf,'textbox',...
    [0.195 0.0616666666666667 0.0843405448717986 0.0884654800431553],...
    'String','$v_{-}$',...
    'Interpreter','latex',...
    'FontSize',35,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.285 0.0616666666666667 0.0843405448717986 0.0884654800431553],...
    'String','$v_{0}$',...
    'Interpreter','latex',...
    'FontSize',35,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation(gcf,'textbox',...
    [0.425 0.0616666666666667 0.0843405448717986 0.0884654800431553],...
    'String','$v_{+}$',...
    'Interpreter','latex',...
    'FontSize',35,...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation('textbox',...
    [0.496666666666669 0.0683333333333335 0.0799999999999985 0.0701321467098224],...
    'Color',[0 0 1],...
    'String','$N_{1}$',...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation('textbox',...
    [0.678333333333335 0.0683333333333335 0.0799999999999985 0.0701321467098224],...
    'Color',[0 0 1],...
    'String','$N_{2}$',...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation('textbox',...
    [0.821666666666667 0.0683333333333335 0.0799999999999985 0.0701321467098224],...
    'Color',[0 0 1],...
    'String','$N_{3}$',...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation('textbox',...
    [0.0458333333333353 0.501666666666668 0.0799999999999989 0.0701321467098223],...
    'Color',[0 0 1],...
    'String','$N_{1}$',...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation('textbox',...
    [0.0458333333333353 0.695000000000004 0.0799999999999992 0.0701321467098224],...
    'Color',[0 0 1],...
    'String','$N_{2}$',...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');
annotation('textbox',...
    [0.0458333333333353 0.840000000000002 0.079999999999999 0.0701321467098223],...
    'Color',[0 0 1],...
    'String','$N_{3}$',...
    'Interpreter','latex',...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');
% 

annotation('textbox',...
    [0.562500000000005 0.329166666666674 0.276666666666666 0.0701321467098222],...
    'Color','k',...
    'String','$u+v=N_{+}$',...
    'Interpreter','latex',...
    'Rotation', -45,...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');

annotation('textbox',...
    [0.350000000000002 0.330833333333341 0.276666666666665 0.0701321467098222],...
    'Color','k',...
    'String','$u+v=N_{-}$',...
    'Interpreter','latex',...
    'Rotation', -45,...
    'FontSize',24,...
    'FitBoxToText','off',...
    'EdgeColor','none');

%% arrows
annotation('arrow',[0.1375 0.165],[0.515833333333333 0.4875],...
    'Color',[1 0 0],...
    'LineWidth',2,...
    'HeadWidth',15,...
    'HeadLength',15);

annotation('arrow',[0.3 0.196666666666667],...
    [0.3525 0.455833333333334],'Color',[1 0 0],'LineWidth',2,'HeadWidth',15,...
    'HeadLength',15);

annotation('arrow',[0.60166666666667 0.498333333333337],...
    [0.246666666666668 0.350000000000002],'Color',[1 0 0],'LineWidth',2,...
    'HeadWidth',15,...
    'HeadLength',15);
annotation('arrow',[0.758333333333334 0.513333333333338],...
    [0.235 0.480833333333336],'Color',[1 0 0],'LineWidth',2,'HeadWidth',15,...
    'HeadLength',15);

annotation('arrow',[0.291666666666667 0.245000000000004],...
    [0.5575 0.604166666666669],'Color',[1 0 0],'LineWidth',2,'HeadWidth',15,...
    'HeadLength',15);


annotation('arrow',[0.183333333333333 0.443333333333339],...
    [0.810833333333334 0.550000000000003],'Color',[1 0 0],'LineWidth',2,...
    'HeadWidth',15,...
    'HeadLength',15);

annotation('arrow',[0.151666666666667 0.208333333333333],...
    [0.695833333333334 0.640833333333333],'Color',[1 0 0],'LineWidth',2,...
    'HeadWidth',15,...
    'HeadLength',15);
annotation('arrow',[0.358333333333333 0.440833333333333],...
    [0.490833333333333 0.408333333333333],'Color',[1 0 0],'LineWidth',2,...
    'HeadWidth',15,...
    'HeadLength',15);


figure_name = ['./Figure1a.eps'];
saveas(gcf, figure_name, 'epsc');





